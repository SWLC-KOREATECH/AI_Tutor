<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <title>ì¼í•™ìŠµë³‘í–‰ AI íŠœí„°</title>
    <style>
      /* ì „ì²´ ë ˆì´ì•„ì›ƒ (ëª¨ë°”ì¼ ì¹œí™”ì ) */
      body { font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif; background-color: #f2f2f2; margin: 0; display: flex; flex-direction: column; height: 100vh; }
      
      /* í—¤ë” */
      .header { background-color: #3b2479; color: white; padding: 15px; text-align: center; font-weight: bold; font-size: 1.1em; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
      
      /* ì±„íŒ… ì˜ì—­ */
      #chat-container { flex: 1; overflow-y: auto; padding: 15px; display: flex; flex-direction: column; gap: 10px; }
      
      /* ë§í’ì„  ìŠ¤íƒ€ì¼ */
      .message { max-width: 80%; padding: 10px 14px; border-radius: 15px; font-size: 0.95em; line-height: 1.5; position: relative; word-wrap: break-word; }
      .bot-msg { align-self: flex-start; background-color: white; color: #333; border-top-left-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
      .user-msg { align-self: flex-end; background-color: #fee500; color: #3b1e1e; border-top-right-radius: 2px; box-shadow: 0 1px 2px rgba(0,0,0,0.1); }
      
      /* ì…ë ¥ ì˜ì—­ */
      .input-area { background: white; padding: 10px; border-top: 1px solid #ddd; display: flex; flex-direction: column; gap: 8px; }
      
      /* ê¸°ëŠ¥ ì„ íƒ ë²„íŠ¼ë“¤ (ìŠ¤í¬ë¡¤ ê°€ëŠ¥) */
      .mode-selector { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 5px; -webkit-overflow-scrolling: touch; }
      .mode-btn { background: #eee; border: none; padding: 8px 12px; border-radius: 20px; font-size: 0.85em; white-space: nowrap; cursor: pointer; color: #555; transition: all 0.2s; }
      .mode-btn.active { background: #3b2479; color: white; font-weight: bold; }
      
      /* ì…ë ¥ì°½ê³¼ ì „ì†¡ë²„íŠ¼ */
      .input-wrapper { display: flex; gap: 10px; }
      input[type="text"] { flex: 1; padding: 12px; border: 1px solid #ddd; border-radius: 20px; outline: none; font-size: 1em; }
      button#send-btn { background: #3b2479; color: white; border: none; padding: 0 20px; border-radius: 20px; cursor: pointer; font-weight: bold; }
      button#send-btn:disabled { background: #ccc; }

      /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
      .typing-indicator { display: none; align-self: flex-start; background: white; padding: 8px 12px; border-radius: 15px; margin-bottom: 10px; font-size: 0.8em; color: #888; }
      .typing-indicator span { display: inline-block; width: 5px; height: 5px; background-color: #888; border-radius: 50%; animation: typing 1s infinite; margin: 0 2px; }
      @keyframes typing { 0% { opacity: 0.3; transform: translateY(0); } 50% { opacity: 1; transform: translateY(-3px); } 100% { opacity: 0.3; transform: translateY(0); } }

      /* ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ (ê°„ë‹¨) */
      .bot-msg strong { color: #3b2479; }
      .bot-msg p { margin: 5px 0; }
    </style>
  </head>
  <body>
    <div class="header">ğŸ“ ì¼í•™ìŠµë³‘í–‰ ìŠ¤ë§ˆíŠ¸ AI íŠœí„°</div>
    
    <div id="chat-container">
      <div class="message bot-msg">
        ì•ˆë…•í•˜ì„¸ìš”! ğŸ‘‹<br>
        ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”? ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸°ëŠ¥ì„ ì„ íƒí•´ë³´ì„¸ìš”.
      </div>
    </div>

    <div class="typing-indicator" id="loading">
      ë‹µë³€ ì‘ì„± ì¤‘ <span></span><span></span><span></span>
    </div>

    <div class="input-area">
      <div class="mode-selector">
        <button class="mode-btn active" onclick="setMode('ì¼ë°˜', this)">ğŸ’¬ ì¼ë°˜ëŒ€í™”</button>
        <button class="mode-btn" onclick="setMode('ê·œì •', this)">ğŸ“˜ ê·œì •ê²€ìƒ‰</button>
        <button class="mode-btn" onclick="setMode('ì¼ì§€', this)">ğŸ“ ì¼ì§€ì‘ì„±</button>
        <button class="mode-btn" onclick="setMode('ì•ˆì „', this)">â›‘ï¸ ì•ˆì „ìˆ˜ì¹™</button>
        <button class="mode-btn" onclick="setMode('í‰ê°€', this)">ğŸ“Š í‰ê°€ìƒì„±</button>
        <button class="mode-btn" onclick="setMode('ìƒë‹´', this)">ğŸ©¹ ìƒë‹´ì¼ì§€</button>
        <button class="mode-btn" onclick="setMode('í€´ì¦ˆ', this)">ğŸ¯ í€´ì¦ˆ</button>
        <button class="mode-btn" onclick="setMode('TBM', this)">ğŸ“¢ TBM</button>
        <button class="mode-btn" onclick="setMode('í†µì—­', this)">ğŸŒ í†µì—­</button>
      </div>

      <div class="input-wrapper">
        <input type="text" id="user-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event)">
        <button id="send-btn" onclick="sendMessage()">ì „ì†¡</button>
      </div>
    </div>

    <script>
      let currentMode = 'ì¼ë°˜';

      function setMode(mode, btn) {
        currentMode = mode;
        // ë²„íŠ¼ ìŠ¤íƒ€ì¼ ë³€ê²½
        document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        
        // íŒíŠ¸ í…ìŠ¤íŠ¸ ë³€ê²½
        const input = document.getElementById('user-input');
        if (mode === 'ì¼ì§€') input.placeholder = "ì˜ˆ: ìš©ì ‘ ì‹¤ìŠµ, ë¹„ë“œ í™•ì¸í–ˆìŠµë‹ˆë‹¤";
        else if (mode === 'ê·œì •') input.placeholder = "ì˜ˆ: ì¶œì„ ì¸ì • ê¸°ì¤€ì´ ë­ì•¼?";
        else if (mode === 'ì•ˆì „') input.placeholder = "ì˜ˆ: ì„ ë°˜ ì‘ì—… ì•ˆì „ìˆ˜ì¹™";
        else input.placeholder = mode + " ê´€ë ¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...";
        
        input.focus();
      }

      function handleEnter(e) {
        if (e.key === 'Enter') sendMessage();
      }

      function sendMessage() {
        const input = document.getElementById('user-input');
        const message = input.value.trim();
        if (!message) return;

        // 1. ë‚´ ë©”ì‹œì§€ í‘œì‹œ
        addMessage(message, 'user');
        input.value = '';
        input.disabled = true;
        document.getElementById('send-btn').disabled = true;

        // 2. ë¡œë”© í‘œì‹œ
        document.getElementById('loading').style.display = 'block';
        scrollToBottom();

        // 3. ì„œë²„ ìš”ì²­ (Google Apps Script)
        google.script.run
          .withSuccessHandler(response => {
            document.getElementById('loading').style.display = 'none';
            addMessage(response, 'bot'); // AI ë‹µë³€ í‘œì‹œ
            input.disabled = false;
            document.getElementById('send-btn').disabled = false;
            input.focus();
          })
          .withFailureHandler(error => {
            document.getElementById('loading').style.display = 'none';
            addMessage("ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.", 'bot');
            input.disabled = false;
            document.getElementById('send-btn').disabled = false;
          })
          .processUserRequest(currentMode, message);
      }

      function addMessage(text, sender) {
        const container = document.getElementById('chat-container');
        const div = document.createElement('div');
        div.className = `message ${sender}-msg`;
        // ê°„ë‹¨í•œ ì¤„ë°”ê¿ˆ ì²˜ë¦¬
        div.innerHTML = text.replace(/\n/g, '<br>'); 
        container.appendChild(div);
        scrollToBottom();
      }

      function scrollToBottom() {
        const container = document.getElementById('chat-container');
        container.scrollTop = container.scrollHeight;
      }
    </script>
  </body>
</html>
