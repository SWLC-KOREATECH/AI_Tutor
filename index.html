<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ì¼í•™ìŠµë³‘í–‰ AI íŠœí„°</title>
    <style>
        /* --- ë””ìì¸ ìŠ¤íƒ€ì¼ (ì¹´ì¹´ì˜¤í†¡ í…Œë§ˆ) --- */
        :root {
            --primary-color: #3b2479; /* ë©”ì¸ ì»¬ëŸ¬ */
            --bg-color: #b2c7d9;      /* ë°°ê²½ìƒ‰ */
            --my-msg-bg: #ffe934;     /* ë‚´ ë©”ì‹œì§€ ë°°ê²½ */
            --bot-msg-bg: #ffffff;    /* ë´‡ ë©”ì‹œì§€ ë°°ê²½ */
        }

        body {
            font-family: 'Apple SD Gothic Neo', 'Noto Sans KR', sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            display: flex;
            flex-direction: column;
            height: 100vh;
            overflow: hidden;
        }

        /* í—¤ë” */
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            z-index: 10;
        }

        /* ì±„íŒ… ì˜ì—­ */
        #chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 15px;
            display: flex;
            flex-direction: column;
            gap: 12px;
            -webkit-overflow-scrolling: touch;
        }

        /* ë©”ì‹œì§€ ìŠ¤íƒ€ì¼ */
        .message {
            max-width: 80%;
            padding: 10px 14px;
            border-radius: 12px;
            font-size: 0.95em;
            line-height: 1.5;
            position: relative;
            word-wrap: break-word;
            box-shadow: 0 1px 1px rgba(0,0,0,0.1);
        }
        
        .bot-msg {
            align-self: flex-start;
            background-color: var(--bot-msg-bg);
            color: #333;
            border-top-left-radius: 2px;
        }
        
        .user-msg {
            align-self: flex-end;
            background-color: var(--my-msg-bg);
            color: #3b1e1e;
            border-top-right-radius: 2px;
        }

        /* ë´‡ í”„ë¡œí•„ ì´ë¯¸ì§€ (ì´ëª¨ì§€ í™œìš©) */
        .bot-profile {
            font-size: 1.5em;
            margin-right: 8px;
            float: left;
        }

        /* ì…ë ¥ ì˜ì—­ ì»¨í…Œì´ë„ˆ */
        .input-container {
            background: white;
            border-top: 1px solid #ddd;
            display: flex;
            flex-direction: column;
            padding-bottom: env(safe-area-inset-bottom); /* ì•„ì´í° í•˜ë‹¨ ëŒ€ì‘ */
        }

        /* ê¸°ëŠ¥ ì„ íƒ ë²„íŠ¼ (ìŠ¤í¬ë¡¤) */
        .mode-selector {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            padding: 10px;
            border-bottom: 1px solid #f0f0f0;
            background: #fafafa;
        }
        
        .mode-btn {
            background: white;
            border: 1px solid #ddd;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.85em;
            white-space: nowrap;
            cursor: pointer;
            color: #555;
            transition: all 0.2s;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .mode-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
            font-weight: bold;
        }

        /* ì¶”ì²œ ê²€ìƒ‰ì–´ (Chips) */
        .suggestion-area {
            padding: 8px 10px 0 10px;
            display: flex;
            gap: 6px;
            overflow-x: auto;
            display: none; /* ê¸°ë³¸ ìˆ¨ê¹€ */
        }
        
        .chip {
            background-color: #eef2ff;
            color: var(--primary-color);
            border: 1px solid #dbeafe;
            padding: 6px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            cursor: pointer;
            white-space: nowrap;
        }

        /* ì…ë ¥ì°½ ë° ì „ì†¡ ë²„íŠ¼ */
        .input-wrapper {
            display: flex;
            gap: 10px;
            padding: 10px;
            align-items: center;
        }
        
        input[type="text"] {
            flex: 1;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            outline: none;
            font-size: 1em;
            background-color: #f9f9f9;
        }
        
        input[type="text"]:focus {
            background-color: white;
            border-color: var(--primary-color);
        }

        button#send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0 15px;
            height: 42px;
            border-radius: 15px;
            cursor: pointer;
            font-weight: bold;
            font-size: 0.9em;
            transition: background 0.2s;
        }
        
        button#send-btn:disabled {
            background: #ccc;
        }

        /* ë¡œë”© ì• ë‹ˆë©”ì´ì…˜ */
        .loading {
            display: none;
            align-self: center;
            background: rgba(0,0,0,0.6);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8em;
            margin-top: 10px;
            position: absolute;
            top: 50%;
            z-index: 100;
        }
        
        /* ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ (ë³¼ë“œì²´ ê°•ì¡°) */
        .bot-msg strong { color: #e53935; font-weight: bold; }

    </style>
</head>
<body>

    <div class="header">ğŸ“ ì¼í•™ìŠµë³‘í–‰ AI íŠœí„°</div>
    
    <div id="chat-container">
        <div class="message bot-msg">
            <span class="bot-profile">ğŸ¤–</span>
            ì•ˆë…•í•˜ì„¸ìš”! <strong>ì¼í•™ìŠµë³‘í–‰ AI íŠœí„°</strong>ì…ë‹ˆë‹¤.<br>
            ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ê¸°ëŠ¥ì„ ì„ íƒí•˜ê³  ëŒ€í™”ë¥¼ ì‹œì‘í•´ ë³´ì„¸ìš”!
        </div>
    </div>

    <div id="loading-spinner" class="loading">ë‹µë³€ ìƒì„± ì¤‘...</div>

    <div class="input-container">
        <div class="mode-selector">
            <button class="mode-btn active" onclick="setMode('ì¼ë°˜', this)">ğŸ’¬ ì¼ë°˜ëŒ€í™”</button>
            <button class="mode-btn" onclick="setMode('/ì¼ì§€', this)">ğŸ“” í•™ìŠµí™œë™ì„œ</button>
            <button class="mode-btn" onclick="setMode('/ì•ˆì „', this)">â›‘ï¸ ì•ˆì „ìˆ˜ì¹™</button>
            <button class="mode-btn" onclick="setMode('/ì§ˆë¬¸', this)">â“ ì§ˆë¬¸</button>
            <button class="mode-btn" onclick="setMode('/ì˜ê²¬', this)">ğŸ“ ì˜ê²¬(ì´í‰)</button>
            <button class="mode-btn" onclick="setMode('/ìƒë‹´', this)">ğŸ©¹ ìƒë‹´ì¼ì§€</button>
            <button class="mode-btn" onclick="setMode('/í€´ì¦ˆ', this)">ğŸ¯ í€´ì¦ˆ</button>
        </div>

        <div id="suggestion-area" class="suggestion-area"></div>

        <div class="input-wrapper">
            <input type="text" id="user-input" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." onkeypress="handleEnter(event)">
            <button id="send-btn" onclick="sendMessage()">ì „ì†¡</button>
        </div>
    </div>

    <script>
        // ğŸš¨ ë°°í¬í•œ Apps Scriptì˜ ì›¹ ì•± URLì„ ì—¬ê¸°ì— ë„£ìœ¼ì„¸ìš”!
        // (ë°˜ë“œì‹œ execë¡œ ëë‚˜ëŠ” ì£¼ì†Œì—¬ì•¼ í•©ë‹ˆë‹¤)
        const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzToluk1SIqKOkWeUNbhPyKIWmgAzj4O-6FtRUdrl44kU0zznVNuf-fZ84JalCnAno/exec"; 

        let currentCommand = ''; // í˜„ì¬ ì„ íƒëœ ëª…ë ¹ì–´ (ì˜ˆ: /í€´ì¦ˆ)
        
        // ê¸°ëŠ¥ë³„ ì¶”ì²œ ì˜ˆì‹œ ë°ì´í„° (ì‰¼í‘œ ì˜¤ë¥˜ ìˆ˜ì •ë¨)
        const suggestions = {
            '/ì¼ì§€': [
                "ì—ìŠ¤í”„ë ˆì†Œ ì¶”ì¶œ ì‹¤ìŠµ, ì›ë‘ ë¶„ì‡„ë„ ì¡°ì ˆ",
                "ë³´ì¼ëŸ¬ ê¸‰ìˆ˜ ì—°ìˆ˜ê¸° ì ê²€, íŒí”„ ì¡°ì‘",
                "ë²”ìš© ì„ ë°˜ ê°€ê³µ, ê³µì‘ë¬¼ ì¤‘ì‹¬ ë§ì¶”ê¸°",
                "3D í”„ë¦°í„° ì¶œë ¥ ì‹¤ìŠµ, í•„ë¼ë©˜íŠ¸ êµì²´"
            ],
            '/ì§ˆë¬¸': [
                "ì¸í„°ë¡ íšŒë¡œê°€ ë­ì•¼?",
                "ë² ì–´ë§ì´ ì™œ í•„ìš”í•´?",
                "ì „ì••ê³¼ ì „ë¥˜ì˜ ì°¨ì´ì ",
                "APIê°€ ë­ì•¼?"
            ],
            '/ì•ˆì „': [
                "ì•„í¬ ìš©ì ‘ê¸° ì‚¬ìš©",
                "ë°€ë§ ë¨¸ì‹  ì‚¬ìš©",
                "ì§€ê²Œì°¨ í™”ë¬¼ ìš´ë°˜ ì‘ì—…",
                "ë°°ì „ë°˜ ì°¨ë‹¨ê¸° êµì²´ ì‘ì—…"
            ],
            '/ì˜ê²¬': [
                "Gì½”ë“œ í”„ë¡œê·¸ë˜ë° ì‘ì„±, ê³µì‘ë¬¼ ì¢Œí‘œê³„ ì„¤ì •, í˜ì´ìŠ¤ì»¤í„° í‰ë©´ ê°€ê³µ",
                "CNC ì„ ë°˜ ê°€ê³µ, ë„ë©´ í•´ì„ì€ ì™„ë²½í•œë° ê³µêµ¬ ë³´ì •(Offset) ê°’ ì…ë ¥ì„ í—·ê°ˆë ¤í•¨",
                "ìœ ì•• íšŒë¡œ êµ¬ì„± ì‹¤ìŠµ, í˜¸ìŠ¤ ì—°ê²°ì€ ëŠ¥ìˆ™í•œë° ë¦´ë¦¬í”„ ë°¸ë¸Œ ì••ë ¥ ì„¤ì •ì„ ì–´ë ¤ì›Œí•¨",
            ],
            '/ìƒë‹´': [
                "CNC ì„ ë°˜ ì¢Œí‘œê³„ ì„¤ì •ì´ ì–´ë µë‹¤ê³  í•¨. ìµœê·¼ ì—¬ìì¹œêµ¬ì™€ ì´ë³„í•¨.",
                "ë°°ì„  ì‘ì—… ì‹¤ìˆ˜ê°€ ì¦ì•„ ìì‹ ì—ê²Œ ì‹¤ë§í•¨. ë°¤ì— ìˆ˜ë©´ì œ ë³µìš©.",
                "ë™ë£Œê°€ ë©´ë°•ì„ ì¤˜ì„œ ì£¼ëˆ… ë“¦. ê·¼ë¬´ ì§€ì† ë¶ˆì•ˆ.",
            ],
            '/í€´ì¦ˆ': [
                "CO2 ìš©ì ‘ í† ì¹˜ ê°ë„ì™€ ì§„í–‰ ë°©í–¥",
                "ì—ìŠ¤í”„ë ˆì†Œ ê³¼ì†Œ ì¶”ì¶œì˜ ì›ì¸",
                "íŒŒì´ì¬ ë³€ìˆ˜ ëª…ëª… ê·œì¹™"
            ]
        };

        // ëª¨ë“œ ë³€ê²½ í•¨ìˆ˜
        function setMode(command, btn) {
            currentCommand = command === 'ì¼ë°˜' ? '' : command;
            
            // ë²„íŠ¼ í™œì„±í™” ìŠ¤íƒ€ì¼
            document.querySelectorAll('.mode-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            
            // ì…ë ¥ì°½ íŒíŠ¸ ë³€ê²½
            const input = document.getElementById('user-input');
            input.placeholder = command === 'ì¼ë°˜' ? "ë¬´ì—‡ì´ë“  ë¬¼ì–´ë³´ì„¸ìš”..." : `${command.replace('/','')} ê´€ë ¨ ë‚´ìš©ì„ ì…ë ¥í•˜ì„¸ìš”...`;
            input.focus();

            // ì¶”ì²œ ì¹©(Chips) ì—…ë°ì´íŠ¸
            updateSuggestions(command);
        }

        // ì¶”ì²œ ì¹© ì—…ë°ì´íŠ¸ í•¨ìˆ˜
        function updateSuggestions(command) {
            const area = document.getElementById('suggestion-area');
            area.innerHTML = ''; // ê¸°ì¡´ ì¹© ì´ˆê¸°í™”
            
            if (suggestions[command]) {
                area.style.display = 'flex'; // ë³´ì´ê¸°
                suggestions[command].forEach(text => {
                    const chip = document.createElement('div');
                    chip.className = 'chip';
                    chip.innerText = text;
                    chip.onclick = () => {
                        document.getElementById('user-input').value = text; // í´ë¦­ ì‹œ ì…ë ¥ì°½ì— ìë™ ì…ë ¥
                        // sendMessage(); // ìë™ ì „ì†¡ì„ ì›í•˜ë©´ ì£¼ì„ í•´ì œ
                    };
                    area.appendChild(chip);
                });
            } else {
                area.style.display = 'none'; // ìˆ¨ê¸°ê¸°
            }
        }

        function handleEnter(e) {
            if (e.key === 'Enter') sendMessage();
        }

        function sendMessage() {
            const input = document.getElementById('user-input');
            const message = input.value.trim();
            if (!message) return;

            // 1. ë‚´ ë©”ì‹œì§€ í‘œì‹œ
            addMessage(message, 'user');
            input.value = '';
            input.disabled = true;
            
            // 2. ë¡œë”© í‘œì‹œ
            document.getElementById('loading-spinner').style.display = 'block';

            // 3. ì„œë²„ë¡œ ì „ì†¡ (ëª…ë ¹ì–´ + í…ìŠ¤íŠ¸)
            // í¼ ë°ì´í„° í˜•ì‹ìœ¼ë¡œ ì „ì†¡
            const formData = new URLSearchParams();
            formData.append('command', currentCommand); 
            formData.append('text', message);           

            fetch(APPS_SCRIPT_URL, {
                method: 'POST',
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                document.getElementById('loading-spinner').style.display = 'none';
                input.disabled = false;
                
                // Code.gsì—ì„œ ë°˜í™˜í•˜ëŠ” JSON êµ¬ì¡°ì— ë”°ë¼ ì²˜ë¦¬
                let botText = "";
                if (data.blocks && data.blocks.length > 1) {
                    botText = data.blocks[1].text.text; 
                } else if (data.text) {
                    botText = data.text;
                } else {
                    botText = "ë‹µë³€ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.";
                }

                addMessage(botText, 'bot');
                input.focus();
            })
            .catch(error => {
                document.getElementById('loading-spinner').style.display = 'none';
                input.disabled = false;
                addMessage("ğŸš¨ í†µì‹  ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.", 'bot');
                console.error(error);
            });
        }

        function addMessage(text, sender) {
            const container = document.getElementById('chat-container');
            const div = document.createElement('div');
            div.className = `message ${sender}-msg`;
            
            // ë§ˆí¬ë‹¤ìš´ ìŠ¤íƒ€ì¼ ê°„ë‹¨ ë³€í™˜ (ì¤„ë°”ê¿ˆ, ë³¼ë“œ)
            let formattedText = text.replace(/\n/g, '<br>');
            formattedText = formattedText.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>'); // **ë³¼ë“œ** ì²˜ë¦¬
            
            div.innerHTML = formattedText;
            container.appendChild(div);
            
            // ìŠ¤í¬ë¡¤ ìµœí•˜ë‹¨ìœ¼ë¡œ ì´ë™
            container.scrollTop = container.scrollHeight;
        }

        // ì´ˆê¸° ì‹¤í–‰
        setMode('ì¼ë°˜', document.querySelector('.mode-btn'));
    </script>
</body>
</html>
